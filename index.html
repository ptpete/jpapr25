<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Checkbox Sync (OAuth 2.0 Client-Side)</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .checkbox-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .checkbox-row label {
            margin-left: 10px;
        }
        #status-message {
            margin-top: 20px;
            font-weight: bold;
        }
        #authorize-button {
            display: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Checkbox Status from Google Sheets (OAuth 2.0)</h1>

    <button id="authorize-button" onclick="handleAuthClick()">Authorize Google Sheets</button>
    <div id="checkbox-container"></div>
    <div id="status-message"></div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = '699729833405-df3jlrnlu218661fjggnv8fd2kj8rh2o.apps.googleusercontent.com'; // **REPLACE THIS WITH YOUR ACTUAL CLIENT ID IF DIFFERENT**
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
        const SHEET_ID = '1Drhe2Hh4e_Vmw8XMa8e7Oyh-4bOB178BoBYRF06n0Gk'; // Your provided Sheet ID
        const SHEET_NAME = 'Sheet1';
        const NAME_COLUMN = 'A';
        const STATUS_COLUMN = 'B';
        const START_ROW = 2;

        let gapiInited = false;
        let gisInited = false;

        document.addEventListener('DOMContentLoaded', () => {
            gapi.load('client', initClient);
        });

        function initClient() {
            gapi.client.init({
                clientId: CLIENT_ID,
                scope: SCOPES,
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
            }).then(() => {
                gapiInited = true;
                checkAuth();
            }).catch(error => {
                console.error('Error initializing gapi:', error);
                statusMessage.textContent = 'Error initializing Google API client.';
            });
        }

        function checkAuth() {
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
            updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        }

        function updateSignInStatus(isSignedIn) {
            if (isSignedIn) {
                console.log('User signed in.');
                document.getElementById('authorize-button').style.display = 'none';
                loadCheckboxes();
            } else {
                console.log('User not signed in.');
                document.getElementById('authorize-button').style.display = 'block';
                statusMessage.textContent = 'Please authorize to access Google Sheets.';
            }
        }

        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn();
        }

        function updateCheckboxStatus(index, isChecked) {
            if (!gapiInited || !gapi.client.sheets || !gapi.auth2.getAuthInstance().isSignedIn.get()) {
                console.error('Google Sheets API not initialized or user not signed in.');
                statusMessage.textContent = 'Not authorized to update.';
                return;
            }

            statusMessage.textContent = `Updating checkbox at index ${index} to ${isChecked}...`;
            const rowIndexInSheet = START_ROW + index;
            const range = `${SHEET_NAME}!${STATUS_COLUMN}${rowIndexInSheet}`;
            const value = [[isChecked.toString().toUpperCase()]];

            gapi.client.sheets.spreadsheets.values.update({
                spreadsheetId: SHEET_ID,
                range: range,
                valueInputOption: 'USER_ENTERED',
                value: value
            }).then((response) => {
                statusMessage.textContent = `Checkbox at index ${index} updated successfully.`;
                console.log('Update response:', response);
            }, (error) => {
                statusMessage.textContent = `Error updating checkbox at index ${index}: ${error.result.error.message}`;
                console.error('Error updating Google Sheet:', error);
            });
        }

        function loadCheckboxes() {
            if (!gapiInited || !gapi.client.sheets || !gapi.auth2.getAuthInstance().isSignedIn.get()) {
                console.error('Google Sheets API not initialized or user not signed in.');
                statusMessage.textContent = 'Not authorized to load data.';
                return;
            }

            statusMessage.textContent = 'Loading checkboxes...';
            const range = `${SHEET_NAME}!${NAME_COLUMN}${START_ROW}:${STATUS_COLUMN}`;

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: SHEET_ID,
                range: range,
            }).then((response) => {
                const data = response.result.values;
                checkboxContainer.innerHTML = '';
                if (data && data.length > 0) {
                    data.forEach((row, index) => {
                        const checkboxName = row[0];
                        const checkedStatus = row[1] === 'TRUE';

                        const checkboxDiv = document.createElement('div');
                        checkboxDiv.classList.add('checkbox-row');

                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.id = checkboxName.toLowerCase().replace(/\s+/g, '-');
                        checkbox.checked = checkedStatus;
                        checkbox.addEventListener('change', function() {
                            updateCheckboxStatus(index, this.checked);
                        });

                        const label = document.createElement('label');
                        label.setAttribute('for', checkbox.id);
                        label.textContent = checkboxName;

                        checkboxDiv.appendChild(checkbox);
                        checkboxDiv.appendChild(label);
                        checkboxContainer.appendChild(checkboxDiv);
                    });
                    statusMessage.textContent = 'Checkboxes loaded.';
                } else {
                    statusMessage.textContent = 'No checkbox data found in the Google Sheet.';
                }
            }, (error) => {
                statusMessage.textContent = `Error loading checkboxes: ${error.result.error.message}`;
                console.error('Error fetching Google Sheet data:', error);
            });
        }
    </script>
</body>
</html>
