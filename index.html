<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Checkbox Sync</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .checkbox-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .checkbox-row label {
            margin-left: 10px;
        }
        #status-message {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Checkbox Status from Google Sheets</h1>

    <div id="checkbox-container">
        </div>

    <div id="status-message"></div>

    <script>
        const apiKey = 'AIzaSyCNxV6lXO282697QMTfh50Cmrl0OSKLW9Q'; // Your provided API key
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/1Drhe2Hh4e_Vmw8XMa8e7Oyh-4bOB178BoBYRF06n0Gk/edit?gid=0#gid=0';
        const sheetId = sheetUrl.split('/d/')[1].split('/')[0];
        const sheetName = 'Sheet1'; // Adjust if your sheet has a different name
        const nameColumn = 'A'; // Column containing checkbox names
        const statusColumn = 'B'; // Column containing checkbox status (TRUE/FALSE)
        const startRow = 2; // Row number where the checkbox data starts

        const checkboxContainer = document.getElementById('checkbox-container');
        const statusMessage = document.getElementById('status-message');

        function updateCheckboxStatus(checkboxName, isChecked) {
            statusMessage.textContent = `Updating ${checkboxName} to ${isChecked}...`;
            const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${statusColumn}${startRow}:${statusColumn}?valueInputOption=USER_ENTERED&key=${apiKey}`;

            fetch(apiUrl, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                if (data.values) {
                    const rowIndex = data.values.findIndex(row => {
                        const nameApiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${nameColumn}${startRow}:${nameColumn}?key=${apiKey}`;
                        return fetch(nameApiUrl)
                            .then(nameResponse => nameResponse.json())
                            .then(nameData => {
                                if (nameData.values && nameData.values[rowIndex] && nameData.values[rowIndex][0] === checkboxName) {
                                    return true;
                                }
                                return false;
                            });
                    });

                    if (rowIndex !== -1) {
                        const updateApiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${statusColumn}${startRow + rowIndex}?valueInputOption=USER_ENTERED&key=${apiKey}`;
                        fetch(updateApiUrl, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                values: [[isChecked.toString().toUpperCase()]]
                            })
                        })
                        .then(updateResponse => updateResponse.json())
                        .then(updateData => {
                            statusMessage.textContent = `${checkboxName} updated successfully.`;
                        })
                        .catch(error => {
                            statusMessage.textContent = `Error updating ${checkboxName}: ${error}`;
                            console.error('Error updating Google Sheet:', error);
                        });
                    } else {
                        statusMessage.textContent = `Checkbox "${checkboxName}" not found in the sheet.`;
                    }
                } else {
                    statusMessage.textContent = 'Could not read checkbox data from the sheet.';
                }
            })
            .catch(error => {
                statusMessage.textContent = `Error fetching checkbox data: ${error}`;
                console.error('Error fetching Google Sheet data:', error);
            });
        }

        function loadCheckboxes() {
            statusMessage.textContent = 'Loading checkboxes...';
            const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${nameColumn}${startRow}:${statusColumn}?key=${apiKey}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    checkboxContainer.innerHTML = ''; // Clear previous checkboxes
                    if (data.values && data.values.length > 0) {
                        data.values.forEach(row => {
                            const checkboxName = row[0];
                            const checkedStatus = row[1] === 'TRUE';

                            const checkboxDiv = document.createElement('div');
                            checkboxDiv.classList.add('checkbox-row');

                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.id = checkboxName.toLowerCase().replace(/\s+/g, '-'); // Create a unique ID
                            checkbox.checked = checkedStatus;
                            checkbox.addEventListener('change', function() {
                                updateCheckboxStatus(checkboxName, this.checked);
                            });

                            const label = document.createElement('label');
                            label.setAttribute('for', checkbox.id);
                            label.textContent = checkboxName;

                            checkboxDiv.appendChild(checkbox);
                            checkboxDiv.appendChild(label);
                            checkboxContainer.appendChild(checkboxDiv);
                        });
                        statusMessage.textContent = 'Checkboxes loaded.';
                    } else {
                        statusMessage.textContent = 'No checkbox data found in the Google Sheet.';
                    }
                })
                .catch(error => {
                    statusMessage.textContent = `Error loading checkboxes: ${error}`;
                    console.error('Error fetching Google Sheet data:', error);
                });
        }

        // Load checkboxes when the page loads
        window.onload = loadCheckboxes;
    </script>
</body>
</html>
